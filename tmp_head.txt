<<<<<<< HEAD// Core state implementations for M2 machine// - Calibration, Standby, Probabilistic Move (TO_A / WAIT_START / TRIAL)// - UI command handling and CSV logging=======/* * ===================================================================================== * *      Project:   M2 Humanâ€“Robot Interaction Experiment Framework *      Module:    M2Machine / M2States *      Purpose:   State machine implementation for M2 robot control, trial logic, *                 effort computation, deterministic perturbation scheduling, and *                 Unity interface synchronization. * *      Author:    Tiancheng (Gavin) Yang *      Student ID: 1456070 *      Affiliation: The University of Melbourne *      Contact:   tianchengy2@student.unimelb.edu.au * * ------------------------------------------------------------------------------------- *      Copyright (c) 2025 Tiancheng Yang, The University of Melbourne *      License: MIT * *      Permission is hereby granted, free of charge, to any person obtaining a copy *      of this software and associated documentation files (the â€œSoftwareâ€?, to deal *      in the Software without restriction, including without limitation the rights *      to use, copy, modify, merge, publish, distribute, sublicense, and/or sell *      copies of the Software, and to permit persons to whom the Software is *      furnished to do so, subject to the following conditions: * *      The above copyright notice and this permission notice shall be included in all *      copies or substantial portions of the Software. * *      THE SOFTWARE IS PROVIDED â€œAS ISâ€? WITHOUT WARRANTY OF ANY KIND, EXPRESS OR *      IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, *      FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE *      AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER *      LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, *      OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE *      SOFTWARE. * * ===================================================================================== */ >>>>>>> ae1f695864d8d49a2e85de7c21549f76c95fc7bd#include <chrono>#include <spdlog/spdlog.h>#include "M2States.h"#include "M2Machine.h"#include <cmath>#include <algorithm>#include <limits>#include <sstream>#include <random>// Local wall-clock helper for CSV timestampsstatic inline double system_time_sec() {    using namespace std::chrono;    return duration_cast<duration<double>>(system_clock::now().time_since_epoch()).count();}// Send a plain-text/structured line back to UIvoid M2ProbMoveState::sendUI_(const std::string& msg) {    const int seq = ++this->txSeq_;    const size_t L = msg.size();    if (machine && machine->UIserver) {        machine->UIserver->sendCmd(msg);    } }// Minimum-jerk trajectory helper (position/velocity/optional acceleration)static inline double MinJerk(const VM2& X0, const VM2& Xf, double T, double t,                             VM2& Xd, VM2& dXd, VM2* ddXd=nullptr){    if (T <= 0) {         Xd = Xf;         dXd.setZero();         if (ddXd)             ddXd->setZero();         return 1.0; 